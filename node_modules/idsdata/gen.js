var ids_data=require("./rawdata");

var isIDC=function(code) {
	return code>=0x2ff0 && code<=0x2fff;
}
var isSurrogate=function(code) {
	return code>=0xD800 && code<=0xDFFF;	
}
var tokenize=function(ids) {
	var i=0;
	var out=[];
	while (i<ids.length) {
		var c=ids.charCodeAt(i);
		if (!isIDC(c)) {
			if (ids[i]=="&") {
				i++;
				while (i<ids.length && ids[i]!=";") {
					i++;
				}
			} else {
				if (isSurrogate(c)) {
					out.push(ids[i]+ids[i+1]);
					i++;
				} else { //normal BMP
					out.push(ids[i]);
				}
			}
		}
		i++;
	}
	return out;
}

var inverted={};
var gen=function() {
	for (var key in ids_data) {
		if (key[0]=="&") continue;
		var parts=tokenize(ids_data[key]);

		for (var i=0;i<parts.length;i++) {
			var part=parts[i];
			if (!inverted[part])  inverted[part]="";
			inverted[part]+=key;
		}
	}	
	return inverted;
}


require("fs").writeFileSync( "decompose.js", "module.exports="+JSON.stringify(gen(),""," "),"utf8");